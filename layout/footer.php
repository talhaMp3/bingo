<!-- footer section -->
<!-- footer section start -->
<section class="footer-section px-xl-20 px-lg-10 px-sm-7 bg-n100">
    <div class="container-fluid">
        <div class="row g-lg-0 g-6 justify-content-lg-between">
            <div class="col-xxl-8 col-12">
                <div class="p-4xl-20 p-xl-10 p-lg-8 p-6 border border-n0-1 bg-n0-5">
                    <div class="row row-cols-lg-6 g-6 justify-content-between">
                        <div class="col-lg-4 col-auto">
                            <div class="mb-lg-6 mb-4">
                                <div class="footer-logo mb-lg-4 mb-2">
                                    <img src="assets/images/logo-white.png" alt="logo" />
                                </div>
                                <p class="text-n0 text-base fw-normal ch-40">
                                    elling premium products, designed to elevate your everyday
                                    experience
                                </p>
                            </div>

                            <ul
                                class="d-flex align-items-center gap-2 mb-lg-10 mb-md-8 mb-6">
                                <li>
                                    <a
                                        href="#"
                                        class="icon-40px text-xl text-n0 bg-n2-8 box-style box-secondary2"><i class="ph-fill ph-facebook-logo"></i></a>
                                </li>
                                <li>
                                    <a
                                        href="#"
                                        class="icon-40px text-xl text-n0 bg-n2-8 box-style box-secondary2"><i class="ph-fill ph-twitter-logo"></i></a>
                                </li>
                                <li>
                                    <a
                                        href="#"
                                        class="icon-40px text-xl text-n0 bg-n2-8 box-style box-secondary2"><i class="ph-fill ph-instagram-logo"></i></a>
                                </li>
                                <li>
                                    <a
                                        href="#"
                                        class="icon-40px text-xl text-n0 bg-n2-8 box-style box-secondary2"><i class="ph-fill ph-youtube-logo"></i></a>
                                </li>
                            </ul>

                            <ul class="d-flex align-items-center gap-2">
                                <li><img src="assets/images/visa.png" alt="visa" /></li>
                                <li>
                                    <img src="assets/images/shopify.png" alt="shopify" />
                                </li>
                                <li>
                                    <img
                                        src="assets/images/mastercard.png"
                                        alt="mastercard" />
                                </li>
                                <li><img src="assets/images/paypal.png" alt="paypal" /></li>
                            </ul>
                        </div>
                        <div class="col-auto">
                            <h4 class="text-animation-word text-n0 mb-lg-6 mb-4">Shop</h4>
                            <ul class="d-grid gap-lg-4 gap-2">
                                <li>
                                    <a
                                        href="shop.html"
                                        class="text-n0 text-base fw-normal hover-text-secondary2">Bikes</a>
                                </li>
                                <li>
                                    <a
                                        href="shop.html"
                                        class="text-n0 text-base fw-normal hover-text-secondary2">Accessories</a>
                                </li>
                                <li>
                                    <a
                                        href="shop.html"
                                        class="text-n0 text-base fw-normal hover-text-secondary2">Clothing</a>
                                </li>
                                <li>
                                    <a
                                        href="shop.html"
                                        class="text-n0 text-base fw-normal hover-text-secondary2">Tool</a>
                                </li>
                                <li>
                                    <a
                                        href="shop.html"
                                        class="text-n0 text-base fw-normal hover-text-secondary2">Hydration</a>
                                </li>
                                <li>
                                    <a
                                        href="shop.html"
                                        class="text-n0 text-base fw-normal hover-text-secondary2">Equipment</a>
                                </li>
                            </ul>
                        </div>
                        <div class="col-auto">
                            <h4 class="text-animation-word text-n0 mb-lg-6 mb-4">
                                Pages
                            </h4>
                            <ul class="d-grid gap-lg-4 gap-2">
                                <li>
                                    <a
                                        href="index.html"
                                        class="text-n0 text-base fw-normal hover-text-secondary2">Home</a>
                                </li>
                                <li>
                                    <a
                                        href="about-us.html"
                                        class="text-n0 text-base fw-normal hover-text-secondary2">About Us</a>
                                </li>
                                <li>
                                    <a
                                        href="services.html"
                                        class="text-n0 text-base fw-normal hover-text-secondary2">Services</a>
                                </li>
                                <li>
                                    <a
                                        href="shop.html"
                                        class="text-n0 text-base fw-normal hover-text-secondary2">Shop</a>
                                </li>
                                <li>
                                    <a
                                        href="blogs.html"
                                        class="text-n0 text-base fw-normal hover-text-secondary2">News</a>
                                </li>
                            </ul>
                        </div>
                        <div class="col-lg-3 col-auto">
                            <h4 class="text-animation-word text-n0 mb-lg-6 mb-4">
                                Support
                            </h4>
                            <ul class="d-grid gap-lg-4 gap-2">
                                <li>
                                    <a
                                        href="faqs.html"
                                        class="text-n0 text-base fw-normal hover-text-secondary2">FAQs</a>
                                </li>
                                <li>
                                    <a
                                        href="warranty-policy.html"
                                        class="text-n0 text-base fw-normal hover-text-secondary2">Warranty Policy</a>
                                </li>
                                <li>
                                    <a
                                        href="shipping-delivery.html"
                                        class="text-n0 text-base fw-normal hover-text-secondary2">Shipping & Delivery</a>
                                </li>
                                <li>
                                    <a
                                        href="how-to-order.html"
                                        class="text-n0 text-base fw-normal hover-text-secondary2">How to Order</a>
                                </li>
                                <li>
                                    <a
                                        href="exchange-return.html"
                                        class="text-n0 text-base fw-normal hover-text-secondary2">Exchange $ Return Policy</a>
                                </li>
                                <li>
                                    <a
                                        href="terms-of-offers.html"
                                        class="text-n0 text-base fw-normal hover-text-secondary2">Terms of Offers</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xxl-4">
                <div class="footer-map">
                    <iframe
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d42292.8315719577!2d-106.56972643793605!3d52.084128685484096!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x5304f24dba300731%3A0x459e39b334a99d2c!2sCostco%20Wholesale!5e1!3m2!1sen!2sbd!4v1726546261198!5m2!1sen!2sbd"
                        style="border: 0"
                        allowfullscreen=""
                        loading="lazy"
                        referrerpolicy="no-referrer-when-downgrade"></iframe>
                </div>
            </div>
        </div>
        <div class="d-between flex-wrap-reverse py-lg-6 py-4">
            <p class="text-n0 text-base fw-normal">
                Copyright Â© <span class="currentYear"></span>
                <a href="index.html" class="text-secondary2">CycleCity</a>. All
                Rights Reserved
            </p>
            <ul class="d-flex align-items-center gap-lg-6 gap-3">
                <li>
                    <a
                        href="privacy-policy.html"
                        class="text-n0 text-base fw-normal hover-text-secondary2">Privacy Policy</a>
                </li>
                <li>
                    <a
                        href="terms-conditions.html"
                        class="text-n0 text-base fw-normal hover-text-secondary2">Terms & Conditions</a>
                </li>
            </ul>
        </div>
    </div>
</section>


<!-- <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="loginModalLabel">Login Required</h4>
            </div>
            <div class="modal-body">
               
                <form action="login.php" method="POST">
                    <input type="email" name="email" class="form-control mb-2" placeholder="Email" required>
                    <input type="password" name="password" class="form-control mb-2" placeholder="Password" required>
                    <button type="submit" class="btn btn-primary w-100">Login</button>
                </form>
            </div>
        </div>
    </div>
</div> -->
<style>
    /* Custom Google Sign-in Button Styles */
    .custom-google-btn {
        width: 100% !important;
    }

    /* Override Google's default button styling */
    .custom-google-btn iframe,
    .custom-google-btn div[role="button"] {
        width: 100% !important;
        min-width: 100% !important;
        max-width: 100% !important;
        border-radius: 8px !important;
        /* Square corners, adjust as needed */
        height: 50px !important;
    }

    /* Additional styling for the container */
    #g_id_signin {
        width: 100%;
    }

    .g_id_signin {
        width: 100% !important;
        display: block !important;
    }

    /* If you want perfectly square button */
    .square-btn .custom-google-btn iframe,
    .square-btn .custom-google-btn div[role="button"] {
        height: 60px !important;
        /* Adjust height to make it square-ish */
        border-radius: 4px !important;
        /* More square appearance */
    }
</style>
<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true"
    data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header border-0 pb-2">
                <div class="w-100 text-center">
                    <h1 class="modal-title fs-4 fw-bold text-dark mb-0" id="loginModalLabel">
                        <i class="fas fa-lock text-primary me-2"></i>
                        Welcome Back
                    </h1>
                    <p class="text-muted small mb-0 mt-1">Please sign in to your account</p>
                </div>
                <button type="button" class="btn-close position-absolute top-0 end-0 mt-3 me-3" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body px-4 pb-4 row">
                <?php if (isset($_SESSION['error'])): ?>
                    <div class="col-12 mb-lg-15 mb-md-10 mb-8 mx-auto">
                        <div class="alert alert-danger mb-4">
                            <?= $_SESSION['error'];
                            unset($_SESSION['error']); ?>
                        </div>
                    </div>
                <?php endif; ?>

                <?php if (isset($_SESSION['success'])): ?>
                    <div class="col-12 mb-lg-15 mb-md-10 mb-8 mx-auto">
                        <div class="alert alert-success mb-4">
                            <?= $_SESSION['success'];
                            unset($_SESSION['success']); ?>
                        </div>
                    </div>
                <?php endif; ?>
                <!-- Normal Login Form -->
                <form method="POST" id="ajaxLoginForm" class="col-12 d-grid gap-lg-6 gap-4 mb-lg-3 mb-md-3 mb-6">
                    <input type="hidden" name="action" value="ajax_login">
                    <input type="hidden" name="redirect_to" value="<?= htmlspecialchars($_SERVER['REQUEST_URI']); ?>">

                    <!-- Email -->
                    <div class="d-grid gap-lg-4 gap-2">
                        <label class="text-n100 font-noto-sans text-base fw-normal">Email</label>
                        <input type="email" name="email"
                            class="py-lg-4 py-2 px-lg-6 px-4 w-100 bg-n0 text-n100 radius-8 border border-n100-1 focus-secondary2"
                            placeholder="Enter Your Email" required>
                    </div>

                    <!-- Password -->
                    <div class="d-grid gap-lg-4 gap-2">
                        <label class="text-n100 font-noto-sans text-base fw-normal">Password</label>
                        <div
                            class="d-flex align-items-center py-lg-4 py-2 px-lg-6 px-4 w-100 bg-n0 text-n100 radius-8 border border-n100-1 focus-secondary2">
                            <input type="password" name="password" class="w-100 border-0" placeholder="Enter Password" required>
                            <button type="button" class="text-xl password-toggle">
                                <i class="ph ph-eye-slash"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Remember Me & Forgot Password -->
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center gap-2">
                            <input type="checkbox" name="remember_me" id="remember_me" class="form-check-input">
                            <label for="remember_me" class="text-n100 font-noto-sans text-sm">Remember Me</label>
                        </div>
                        <a href="forgot-password.php" class="text-secondary2 text-sm">Forgot Password?</a>
                    </div>

                    <!-- Submit -->
                    <button type="submit" class="btn-secondary py-lg-4 py-2 px-lg-6 px-4 radius-8 w-100">Login</button>
                </form>
                <div class="col-12">
                    <ul class="d-center gap-3 ">
                        <li class="w-100">
                            <!-- Google Login -->
                            <div id="g_id_signin" class="mt-3 w-100">
                                <div id="g_id_onload"
                                    data-client_id="29999697984-l7ihjbcmdnettkh5f9fhr78sskghe8qm.apps.googleusercontent.com"
                                    data-context="signin"
                                    data-ux_mode="popup"
                                    data-login_uri="http://localhost:8000/google-login.php"
                                    data-auto_prompt="false">
                                </div>

                                <div class="g_id_signin"
                                    data-type="standard"
                                    data-shape="rectangular"
                                    data-theme="outline"
                                    data-text="signin_with"
                                    data-size="large"
                                    data-logo_alignment="center"
                                    data-width="100%">
                                </div>
                            </div>
                        </li>
                    </ul>
                    <div class="text-center mb-lg-4 mb-2 mt-4">
                        <span class="text-n50">Don't have an account?</span>
                        <a href="register.php" class="text-secondary2 fw-medium">Register</a>
                    </div>
                </div>


            </div>
        </div>
    </div>
</div>




<!-- footer section end -->
<script src="https://accounts.google.com/gsi/client" async defer></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.1/cookieconsent.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.1/cookieconsent.min.js"></script>


<script>
    window.addEventListener("load", function() {
        window.cookieconsent.initialise({
            palette: {
                popup: {
                    background: "#e7eff0",
                    text: "#333333"
                },
                button: {
                    background: "#e74c3c",
                    text: "#ffffff"
                }
            },
            theme: "classic",
            position: "bottom",
            content: {
                message: "We use cookies on our site to enhance your user experience, provide personalized content, and analyze our traffic.",
                dismiss: "Accept all",
                deny: "Reject non-essential",
                link: "Cookie Policy",
                href: "/cookie-policy.php"
            },
            type: "opt-in",
            revokable: false
        });
    });
</script>


<?php if (isset($_SESSION['toast'])): ?>
    <script>
        Swal.fire({
            toast: true,
            position: 'top-end',
            icon: '<?= $_SESSION['toast']['type'] ?>',
            title: '<?= $_SESSION['toast']['message'] ?>',
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
        });
    </script>
    <?php unset($_SESSION['toast']); ?>
<?php endif; ?>
<script>
    $(document).ready(function() {
        $('#ajaxLoginForm').submit(function(e) {
            e.preventDefault();
            const formData = $(this).serialize();
            console.log(formData);

            $.ajax({
                url: 'functions/ajax-login.php',
                type: 'POST',
                data: formData,
                dataType: 'json',
                success: function(response) {
                    // console.log(response);
                    if (response.success) {
                        Swal.fire({
                            toast: true,
                            position: 'top-end',
                            icon: 'success',
                            title: response.message,
                            showConfirmButton: false,
                            timer: 3000,
                            timerProgressBar: true,
                            didOpen: (toast) => {
                                toast.addEventListener('mouseenter', Swal.stopTimer);
                                toast.addEventListener('mouseleave', Swal.resumeTimer);
                            }
                        });
                        // location.href = response.redirect || window.location.href;
                        $('#loginModal').modal('hide');
                        // Redirect after short delay
                        setTimeout(() => {
                            window.location.href = response.redirect || window.location.href;
                        }, 2000);
                    } else {
                        // Show error message in the modal
                        $('#ajaxLoginForm').prepend(`
                                    <div class="alert alert-danger">${response.message}</div>
                                `);
                    }
                },
                error: function() {
                    $('#ajaxLoginForm').prepend(`
                                <div class="alert alert-danger">Something went wrong. Please try again.</div>
                            `);
                }
            });
        });
    });
</script>

<script>
    // Wishlist Related Scripts
    $(document).ready(function() {
        // Add to wishlist function (for use in other pages)
        window.addToWishlist = function(productId, variantId, button) {
            $.ajax({
                url: 'functions/whishlist.php',
                type: 'POST',
                data: {
                    action: 'add',
                    product_id: productId,
                    variant_id: variantId
                },
                dataType: 'json',
                beforeSend: function() {
                    $(button).addClass('btn-loading').html('<i class="fas fa-spinner fa-spin"></i> Adding...');
                },
                success: function(response) {
                    if (response.login_required) {
                        // Trigger login modal
                        $('#loginModal').modal('show');
                    }
                    if (response.success) {
                        $(button).removeClass('btn-outline-danger addToWishlist btn-loading')
                            .addClass('btn-danger removeFromWishlist')
                            .html('<i class="ph-heart ph-fill"></i>');
                        updateWishlistCount();
                        showToast('success', response.message);
                    } else {
                        $(button).removeClass('btn-loading').html('<i class="ph-heart ph-fill"></i>');
                        showToast('error', response.message);
                    }
                },
                error: function() {
                    $(button).removeClass('btn-loading').html('<i class="ph-heart ph-fill"></i>');
                    showToast('error', response.message || 'An error occurred while adding to wishlist');
                }
            });
        };

        // Add to wishlist event
        $(document).on('click', '.addToWishlist', function() {
            var productId = $(this).data('product');
            var variantId = $(this).data('variant');

            addToWishlist(productId, variantId, this);
        });

        // Remove from wishlist
        $(document).on('click', '.removeFromWishlist', function() {
            var productId = $(this).data('product');
            var button = $(this);
            var container = button.closest('.wishlist-item-container');
            Swal.fire({
                toast: false,
                title: "Are you sure you want to remove this item from your wishlist?",
                showDenyButton: false,
                showCancelButton: true,
                confirmButtonText: "Remove",
                denyButtonText: `Don't remove`,
            }).then((result) => {
                /* Read more about isConfirmed, isDenied below */
                if (result.isConfirmed) {
                    // if (confirm('Are you sure you want to remove this item from your wishlist?')) {
                    $.ajax({
                        url: 'functions/whishlist.php',
                        type: 'POST',
                        data: {
                            action: 'remove',
                            product_id: productId
                        },
                        dataType: 'json',
                        beforeSend: function() {
                            button.addClass('btn-loading').html('<i class="fas fa-spinner fa-spin"></i> Removing...');
                        },
                        success: function(response) {
                            if (response.success) {

                                if (container.length) {
                                    // On wishlist page - remove the item
                                    container.fadeOut(300, function() {
                                        $(this).remove();
                                        checkEmptyWishlist();
                                    });
                                } else {
                                    // On other pages - change button back
                                    // .wishlist-item find this class and remove the element
                                    const item = button.closest('.wishlist-item');
                                    item.remove();
                                    button.removeClass('btn-danger removeFromWishlist btn-loading')
                                        .addClass('btn-outline-danger addToWishlist')
                                        .html('<i class="ph-heart ph-fill"></i>');
                                }
                                updateWishlistCount();
                                showToast('success', response.message);
                            } else {
                                button.removeClass('btn-loading').html('<i class="ph-heart ph-fill"></i>');
                                showToast('error', response.message);
                            }
                        },
                        error: function() {
                            button.removeClass('btn-loading').html('<i class="ph-heart ph-fill"></i>');
                            showToast('error', 'An error occurred while removing from wishlist');
                        }
                    });
                    // }
                    Swal.fire("Removed!", "", "success");
                } else if (result.isDenied) {
                    Swal.fire("Changes are not saved", "", "info");
                }
            });

        });

        // Clear entire wishlist
        $('#clearWishlist').click(function() {
            Swal.fire({
                title: 'Are you sure?',
                text: "Your entire wishlist will be cleared. This action cannot be undone!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Yes, clear it!',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: 'functions/whishlist.php',
                        type: 'POST',
                        data: {
                            action: 'clear'
                        },
                        dataType: 'json',
                        beforeSend: function() {
                            $('#clearWishlist').addClass('btn-loading').html('<i class="fas fa-spinner fa-spin"></i> Clearing...');
                        },
                        success: function(response) {
                            if (response.success) {
                                Swal.fire(
                                    'Cleared!',
                                    'Your wishlist has been emptied.',
                                    'success'
                                ).then(() => {
                                    location.reload();
                                });
                            } else {
                                $('#clearWishlist').removeClass('btn-loading').html('<i class="fas fa-trash"></i> Clear All');
                                showToast('error', response.message);
                            }
                        },
                        error: function() {
                            $('#clearWishlist').removeClass('btn-loading').html('<i class="fas fa-trash"></i> Clear All');
                            showToast('error', 'An error occurred while clearing wishlist');
                        }
                    });
                }
            });
        });
        // Update wishlist count
        function updateWishlistCount() {
            $.ajax({
                url: 'functions/whishlist.php',
                type: 'GET',
                data: {
                    action: 'count'
                },
                dataType: 'json',
                success: function(response) {

                    if (response.success) {
                        $('.whishlist_count').text(response.count);
                        if (response.count > 0) {
                            $('.whishlist_count').show();
                        } else {
                            $('.whishlist_count').hide();
                        }
                    }
                },
                error: function(xhr, status, error) {
                    console.error("Error updating wishlist:", error);
                }
            });
        }
        // Check wishlist emptiness
        function checkEmptyWishlist() {
            if ($('.wishlist-item-container').length === 0) {
                setTimeout(function() {
                    location.reload();
                }, 500);
            }
        }
    });





    $(document).ready(function() {
        // Quantity Buttons


        // Add to Cart
        $('.addToCart').on('click', function() {
            const $btn = $(this);
            const productId = $btn.data('product');
            const variantId = $btn.data('variant') || null;
            const $quantityInput = $btn.closest('.d-flex').find('.quantityValue');
            const quantity = parseInt($quantityInput.val()) || 1;

            // Disable button temporarily
            $btn.prop('disabled', true).text('Adding...');

            $.ajax({
                url: 'functions/cart.php',
                type: 'POST',
                dataType: 'json',
                data: {
                    action: 'add_to_cart',
                    product_id: productId,
                    variant_id: variantId,
                    quantity: quantity
                },
                success: function(data) {
                    if (data.login_required) {
                        $('#loginModal').modal({
                            backdrop: 'static',
                            keyboard: false
                        }).modal('show');
                    } else if (data.success) {
                        // You can replace this with a toast/snackbar
                        // alert('â ' + data.message);
                        showToast('success', data.message);
                        $('.card-count').text(data.cart_count);

                    } else {
                        showToast('error', data.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.log(error);
                    showToast('error', 'ð¨ Something went wrong. Please try again.');
                },
                complete: function() {
                    $btn.prop('disabled', false).text('ADD TO CART');
                }
            });
        });
    });
    // SweetAlert Toast Message
    function showToast(type, message) {
        Swal.fire({
            toast: true,
            position: 'top-end',
            icon: type,
            title: message,
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
            didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer);
                toast.addEventListener('mouseleave', Swal.resumeTimer);
            }
        });
    }

    function updateCart(productId, newQty) {
        $.ajax({
            url: './functions/cart.php',
            type: 'POST',
            data: {
                action: 'update_qty',
                cart_id: productId,
                quantity: newQty
            },
            dataType: 'json',
            success: function(response) {
                if (response.success) {
                    showToast('success', response.message);
                } else {
                    showToast('error', response.message);
                }
            }
        });
    }

    function removeCart(cartId) {
        $.ajax({
            url: './functions/cart.php',
            type: 'POST',
            data: {
                action: 'remove_cart',
                cart_id: cartId
            },
            dataType: 'json',
            success: function(response) {
                if (response.success) {
                    showToast('success', response.message);
                } else {
                    showToast('error', response.message);
                }
            }
        });
    }


    // Handle Decrement (â)
    $(document).on('click', '.quantityDecrement', function() {
        const $input = $(this).siblings('.quantityValue');
        let value = parseInt($input.val()) || 1;
        if (value > 1) {
            $input.val(value - 1);
            updateCart($(this).data('id'), $input.val());
            // fetchCart();
            fetchCart();
        }
    });

    // Handle Increment (+)
    $(document).on('click', '.quantityIncrement', function() {
        const $input = $(this).siblings('.quantityValue');
        let value = parseInt($input.val()) || 1;
        $input.val(value + 1);
        updateCart($(this).data('id'), $input.val());
        fetchCart();
    });
    $(document).on('click', '.cart-item-remove', function() {

        removeCart($(this).data('id'));
        fetchCart();
    });


    $('.fetch-cart-btn').on('click', function() {
        fetchCart();
    });

    function fetchCart() {
        $.ajax({
            url: './functions/cart.php',
            type: 'POST',
            data: {
                action: 'get_cart',
            },
            dataType: 'json',
            success: function(data) {


                if (data.login_required) {
                    $('#loginModal').modal({
                        backdrop: 'static',
                        keyboard: false
                    }).modal('show');
                } else if (data.success) {
                    // Target wrapper
                    let $wrapper = $(".cart-items");
                    $wrapper.empty(); // clear old items
                    $(".cart-box").addClass("active");

                    // Loop cart items
                    data.cart.forEach(function(item) {
                        // decode image JSON
                        let images = JSON.parse(item.image);
                        let firstImage = images[0]; // just show the first one for now

                        let html = `
                <div class="cart-item d-flex justify-content-between gap-4">
                    <div class="d-flex align-items-center gap-4">
                        <div class="cart-item-thumb">
                            <img class="w-100" src="assets/images/${firstImage}" alt="cart item" />
                        </div>
                        <div class="cart-item-info">
                            <span class="d-block text-n100 text-base fw-medium">${item.name} ${item.qty}</span>
                            <span class="d-block text-n100 text-sm">Qty: ${item.qty}</span>
                            <span class="d-block text-secondary2 text-base my-lg-2 my-1">â¹${item.item_total}</span>
                             <div class="quantity d-inline-flex align-items-center py-1 px-2 border border-n100-1 bg-n20 radius-4">
                    <button class="quantityDecrement text-n100" data-id="${item.cart_id}">
                        <i class="ph ph-minus"></i>
                    </button>
                    <input type="text" value="${item.qty}" class="quantityValue border-0 p-0 outline-0 bg-n20" />
                    <button class="quantityIncrement text-n100" data-id="${item.cart_id}">
                        <i class="ph ph-plus"></i>
                    </button>
                </div>
                        </div>
                    </div>
                    <div class="d-flex flex-column gap-1 align-items-baseline justify-content-start">
                        <button class="cart-item-remove text-xl" data-id="${item.cart_id}" >
                            <i class="ph ph-trash"></i>
                        </button>
                    </div>
                </div>
            `;

                        $wrapper.append(html);
                    });
                    $('.cart-overall_total').text('â¹' + data.overall_total);

                } else {
                    showToast('error', data.message);
                }
            },
            error: function(xhr, status, error) {
                // console.log(error);
                showToast('error', 'ð¨ Something went wrong. Please try again.');
            },
            complete: function() {
                // $btn.prop('disabled', false).text('ADD TO CART');
            }
        });
    }
    $(document).on("click", ".g_id_signin div[role=button]", function(e) {
        e.preventDefault(); // stop default Google popup

        prepareGoogleLogin(); // set redirect in session first
    });

    function prepareGoogleLogin() {
        var redirectUrl = window.location.href;

        $.ajax({
            url: "../functions/set-redirect.php",
            type: "POST",
            data: {
                redirect_url: redirectUrl
            },
            dataType: "json",
            success: function(response) {
                if (response.status === 'success') {
                    console.log("Redirect session set â");
                    // Now open Google login modal
                    $("#googleLoginModal").show();
                } else {
                    console.error("Failed to set redirect:", response.message);
                }
            },
            error: function(xhr, status, error) {
                console.error("AJAX Error:", error);
            }
        });
    }
</script>
</body>

</html>